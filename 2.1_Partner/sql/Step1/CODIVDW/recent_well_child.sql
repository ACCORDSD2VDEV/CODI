DROP TABLE IF EXISTS #recent_well_child;
SELECT DISTINCT
	PERSON_ID AS patid, 
	MAX(DATE) most_recent_well_child_visit
INTO #recent_well_child
FROM 
	(SELECT PERSON_ID 
		MAX(ADMIT_DATE) as DATE
	 FROM @SCHEMA.@PROCEDURES
	 WHERE PX IN ('99382', '99383', '99384', '99385', 
			  '99392', '99393', '99394', '99395')
	 UNION ALL
	 SELECT PERSON_ID 
		MAX(ADMIT_DATE) as DATE
	 FROM @SCHEMA.@DIAGNOSIS
	 WHERE (DX LIKE 'Z00%') OR (DX LIKE 'Z01.411') OR (DX LIKE 'Z01.419') OR (DX LIKE 'Z02.%'))
WHERE DATE >= '6/1/2016' AND DATE < '1/1/2023'
GROUP BY PERSON_ID;
